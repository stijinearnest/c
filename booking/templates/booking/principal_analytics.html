{% extends "booking/base.html" %}
{% block title %}Analytics Dashboard{% endblock %}

{% block content %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
.analytics-container {
    padding: 30px 10px;
}

.filter-card {
    background: white;
    padding: 25px;
    border-radius: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    margin-bottom: 35px;
}

.stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 40px;
}

.stat-card {
    background: #f4f8fb;
    padding: 20px;
    border-radius: 14px;
}

.stat-card h6 {
    color: #6c7a86;
    font-size: 13px;
}

.stat-card h3 {
    color: #2e5e6e;
    margin-top: 8px;
}
</style>

<div class="analytics-container">

    <h2 style="color:#2e5e6e;">ðŸ“Š Advanced Analytics</h2>

    <!-- FILTER SECTION -->
    <div class="filter-card">
        <form method="get">
            <div class="row">

                <div class="col-md-4">
                    <label>Counselor</label>
                    <select name="counselor" class="form-control">
                        <option value="">All Counselors</option>
                        {% for c in counselors %}
                            <option value="{{ c.id }}"
                                {% if selected_counselor == c.id|stringformat:"s" %}selected{% endif %}>
                                {{ c.username }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-3">
                    <label>Start Date</label>
                    <input type="date" name="start" value="{{ start_date }}" class="form-control">
                </div>

                <div class="col-md-3">
                    <label>End Date</label>
                    <input type="date" name="end" value="{{ end_date }}" class="form-control">
                </div>

                <div class="col-md-2 d-flex align-items-end">
                    <button class="btn btn-primary w-100">Apply</button>
                </div>

            </div>
        </form>
    </div>

    <!-- STATISTICS -->
    <div class="stats">
        <div class="stat-card">
            <h6>Total Bookings</h6>
            <h3>{{ total }}</h3>
        </div>

        <div class="stat-card">
            <h6>Attended</h6>
            <h3>{{ attended }}</h3>
        </div>

        <div class="stat-card">
            <h6>Not Attended</h6>
            <h3>{{ not_attended }}</h3>
        </div>

        <div class="stat-card">
            <h6>Emergency Bookings</h6>
            <h3>{{ emergency }}</h3>
        </div>
    </div>

    <!-- CHARTS -->
    <div class="row">

        <div class="col-md-6">
            <canvas id="attendanceChart"></canvas>
        </div>

        <div class="col-md-6">
            <canvas id="emergencyChart"></canvas>
        </div>

    </div>

</div>

<script>
const attendanceChart = new Chart(document.getElementById('attendanceChart'), {
    type: 'doughnut',
    data: {
        labels: ['Attended', 'Not Attended'],
        datasets: [{
            data: [{{ attended }}, {{ not_attended }}],
            backgroundColor: ['#2e5e6e', '#c94c4c']
        }]
    }
});

const emergencyChart = new Chart(document.getElementById('emergencyChart'), {
    type: 'pie',
    data: {
        labels: ['Emergency', 'Regular'],
        datasets: [{
            data: [{{ emergency }}, {{ regular }}],
            backgroundColor: ['#f39c12', '#2e5e6e']
        }]
    }
});
</script>

{% endblock %}